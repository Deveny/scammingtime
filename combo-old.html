<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="GitLab Pages">
    <title>Three.js WebGL and CSS3D Demonstration</title>
      
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
          <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
      <style>
      #css, #webgl {
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0; left: 0;
  overflow: hidden;
}
#css {
  z-index: 1;
    border: 3px solid red;
}
#webgl {
  z-index: 0;
}
body {
  margin: 0;
    background-color: lavender;
}
          .element {
				width: 200px;
				height: 90px;
				box-shadow: 0px 0px 12px lightgray;
                background-color: lightgray;
                opacity: 0.6;
				border: 1px solid lightgray;
              border-radius: 5px;
				font-family: Helvetica, sans-serif;
				text-align: center;
				line-height: normal;
				cursor: default;
            -webkit-animation: glow 1s ease-in-out infinite alternate;
-moz-animation: glow 1s ease-in-out infinite alternate;
animation: glow 1s ease-in-out infinite alternate;
               transition: opacity 0.5s, background-color 1s;
}        
@-webkit-keyframes glow {
  from {
      -webkit-appearance: none;
    box-shadow: inset 0 0 10px white, 0 0 20px white, 0 0 30px lightsalmon, 0 0 40px lightsalmon, 0 0 50px lightsalmon, 0 0 60px lightsalmon, 0 0 70px lightsalmon;
      -webkit-box-shadow: inset 0 0 10px white, 0 0 20px white, 0 0 30px lightsalmon, 0 0 40px lightsalmon, 0 0 50px lightsalmon, 0 0 60px lightsalmon, 0 0 70px lightsalmon;
  }
  to {
      -webkit-appearance: none;
          box-shadow: inset 0 0 20px white, 0 0 30px lavender, 0 0 40px lavender, 0 0 50px lavender, 0 0 60px lavender, 0 0 70px lavender, 0 0 80px lavender;

    -webkit-box-shadow: inset 0 0 20px white, 0 0 30px lavender, 0 0 40px lavender, 0 0 50px lavender, 0 0 60px lavender, 0 0 70px lavender, 0 0 80px lavender;
  } 
}    
          .element:hover{
                opacity: 1;
                 background-image: url('assets/cargrass.png');
                transition: opacity 0.5s, background-color 1s;
              cursor: pointer;
            }
</style>
  </head>
  <body>
    <div id="css"></div>
    <div id="webgl"></div>
    <footer>


<script type="module">
import * as THREE from "/three/build/three.module.js";

import { TWEEN } from "/three/examples/jsm/libs/tween.module.min.js";
import { OrbitControls } from "/three/examples/jsm/controls/OrbitControls.js";
import {
  CSS3DRenderer,
  CSS3DObject
} from "/three/examples/jsm/renderers/CSS3DRenderer.js";

var control,
  controls,
  camera,
  scene,
  webGLRenderer,
  css3DRenderer,
  light,
  domElement;
var objects = [];
var targets = { helix: [] };

init();
animate();

function init() {
  // Create the scene
  scene = new THREE.Scene();
  scene.fog = new THREE.FogExp2(0xaaccff, 0.001);

  // Create the camera
  camera = createCamera();

  var light = new THREE.DirectionalLight(0xfff3d4);
  light.position.set(1, 1, 1);
  scene.add(light);

  var light = new THREE.DirectionalLight(0x002288);
  light.position.set(-1, -1, -1);
  scene.add(light);

  var light = new THREE.AmbientLight(0x222222);
  scene.add(light);

  // Create the DOM element
  // domElement = createText();
  //scene.add( domElement )

  //helix

  var vector = new THREE.Vector3();

  for (var i = 0; i < 6; i += 1) {
    var element = document.createElement("div");
    element.className = "element";

    var object = new CSS3DObject(element);
    scene.add(object);

    var theta = i * 1.05 + Math.PI;
    var y = -450;
    object.position.setFromCylindricalCoords(200, theta, 0);
    objects.push(object);

    vector.x = object.position.x * 2;
    vector.y = object.position.y;
    vector.z = object.position.z * 2;

    object.lookAt(vector);
    targets.helix.push(object);
    element.parent = object;
    object.element.onclick = function () {
      var tween = new TWEEN.Tween(camera.position)
        .to({
          x: this.parent.position.x,
          y: this.parent.position.y,
          z: this.parent.position.z
        })
        .easing(TWEEN.Easing.Linear.None)
        //.onUpdate(function () {camera.lookAt( camera.target ); })
        .onComplete(function () {
          camera.lookAt(this.parent.position);
        })
        .start();

      //var tween = new TWEEN.Tween(camera.target).to({
      //  x: this.parent.position.x,y: this.parent.position.y,z: 0 })
      //.easing(TWEEN.Easing.Linear.None).onUpdate(function () {}).onComplete(function () {camera.lookAt(this.parent.position);}).start();
    };
  }
  transform(targets.helix, 0);

  // Create the renderers
  webGLRenderer = createWebGLRenderer();
  css3DRenderer = createCSS3DRenderer();

  // Create the controls
  controls = createControls();

  // Create the event listener for on resize
  window.addEventListener("resize", onWindowResize, false);
  onWindowResize();

  createGeometryFromMap();

  addPointLight(0xff0000, new THREE.Vector3(-300, 0, 0), "pl1");
  addPointLight(0xff0000, new THREE.Vector3(-100, 0, 0), "pl2");
  addPointLight(0x0000ff, new THREE.Vector3(300, 0, 0), "pl3");
  control = new (function () {
    this.count = 0.01;
  })();
}

function addPointLight(color, position, name) {
  var pointLight = new THREE.PointLight();
  pointLight.color = new THREE.Color(color);
  pointLight.intensity = 4;
  pointLight.distance = 200;

  pointLight.position.copy(position);
  pointLight.name = name;
  scene.add(pointLight);

  var bulbMat = new THREE.MeshBasicMaterial();
  bulbMat.color = new THREE.Color(color);
  pointLight.add(new THREE.Mesh(new THREE.SphereGeometry(0.01), bulbMat));
}
function createGeometryFromMap() {
  var depth = 1024;
  var width = 1024;

  var spacingX = 3;
  var spacingZ = 3;
  var heightOffset = -4;

  var canvas = document.createElement("canvas");
  canvas.width = 1024;
  canvas.height = 1024;
  var ctx = canvas.getContext("2d");

  var img = new Image();
  img.src = "../assets/waterLARGE.jpg";
  img.onload = function () {
    // draw on canvas
    ctx.drawImage(img, 0, 0);
    var pixel = ctx.getImageData(0, 0, width, depth);

    var geom = new THREE.Geometry();
    var output = [];
    for (var x = 0; x < depth; x++) {
      for (var z = 0; z < width; z++) {
        var yValue = pixel.data[z * 4 + depth * x * 4] / heightOffset;
        var vertex = new THREE.Vector3(x * spacingX, yValue, z * spacingZ);
        geom.vertices.push(vertex);
      }
    }

    // we create a rectangle between four vertices, and we do
    // that as two triangles.
    for (var z = 0; z < depth - 1; z++) {
      for (var x = 0; x < width - 1; x++) {
        // we need to point to the position in the array
        // a - - b
        // |  x  |
        // c - - d
        var a = x + z * width;
        var b = x + 1 + z * width;
        var c = x + (z + 1) * width;
        var d = x + 1 + (z + 1) * width;

        var face1 = new THREE.Face3(a, b, d);
        var face2 = new THREE.Face3(d, c, a);

        geom.faces.push(face1);
        geom.faces.push(face2);
      }
    }

    geom.computeVertexNormals(true);
    geom.computeFaceNormals();
    geom.computeBoundingBox();

    var zMax = geom.boundingBox.max.z;
    var xMax = geom.boundingBox.max.x;

    var mesh = new THREE.Mesh(
      geom,
      new THREE.MeshPhongMaterial({
        color: 0x2ad9c6,
        shininess: 40,
        specular: 0x161616
      })
    );
    mesh.translateX(-xMax / 2);
    mesh.translateZ(-zMax / 2);
    mesh.position.y = -70;
    scene.add(mesh);
    mesh.name = "valley";
  };
}
function createCamera() {
  var camera = new THREE.PerspectiveCamera(
    70,
    window.innerWidth / window.innerHeight,
    1,
    10000
  );
  camera.position.z = 500;
  return camera;
}
function createWebGLRenderer() {
  var rendererContainer = document.querySelector("#webgl");
  var renderer = new THREE.WebGLRenderer({
    antialias: true,
    alpha: true
  });
  //renderer.setPixelRatio( window.devicePixelRatio );
  rendererContainer.prepend(renderer.domElement);
  renderer.setSize(window.innerWidth, window.innerHeight);
  return renderer;
}
function createCSS3DRenderer() {
  var rendererContainer = document.querySelector("#css");
  var renderer = new CSS3DRenderer();
  rendererContainer.prepend(renderer.domElement);
  renderer.setSize(window.innerWidth, window.innerHeight);
  return renderer;
}
function createControls() {
  var controls = new OrbitControls(camera, css3DRenderer.domElement);

  // controls.minPolarAngle = Math.PI / 3;
  controls.maxPolarAngle = Math.PI / 2;

  return controls;
}
function transform(targets, duration) {
  TWEEN.removeAll();

  for (var i = 0; i < objects.length; i++) {
    var object = objects[i];
    var target = targets[i];

    new TWEEN.Tween(object.position)
      .to(
        { x: target.position.x, y: target.position.y, z: target.position.z },
        Math.random() * duration + duration
      )
      .easing(TWEEN.Easing.Exponential.InOut)
      .start();

    new TWEEN.Tween(object.rotation)
      .to(
        { x: target.rotation.x, y: target.rotation.y, z: target.rotation.z },
        Math.random() * duration + duration
      )
      .easing(TWEEN.Easing.Exponential.InOut)
      .start();
  }

  new TWEEN.Tween(this).to({}, duration * 2).start();
}
function tweenCamera(targetPosition, duration) {
  controls.enabled = false;

  var position = new THREE.Vector3().copy(camera.position);

  var tween = new TWEEN.Tween(position)
    .to(targetPosition, duration)
    .easing(TWEEN.Easing.Back.InOut)
    .onUpdate(function () {
      camera.position.copy(position);
      camera.lookAt(controls.target);
    })
    .onComplete(function () {
      camera.position.copy(targetPosition);
      camera.lookAt(controls.target);
      controls.enabled = true;
    })
    .start();
}
//var targetPosition = new THREE.Vector3( 10, 10, 10 );
//var duration = 5000;
//tweenCamera( targetPosition, duration );
function onWindowResize() {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  css3DRenderer.setSize(window.innerWidth, window.innerHeight);
  webGLRenderer.setSize(window.innerWidth, window.innerHeight);
}
function animate() {
  //requestAnimationFrame( animate );

  controls.update();
  TWEEN.update();
  controls.addEventListener("change", render);
}
function render() {
  webGLRenderer.render(scene, camera);
  css3DRenderer.render(scene, camera);

  var time = Date.now() * 0.00025;
  var d = 500;

  var light = scene.getObjectByName("pl1");
  light.position.x = Math.cos(time * 0.3) * d;
  light.position.z = 2 * Math.sin(time * 0.7) * d;
  light.position.y = 2 * Math.sin((control.count += 0.005) + 0.5 * Math.PI);

  var light = scene.getObjectByName("pl2");
  light.position.x = Math.sin(time * 0.5) * d;
  light.position.z = Math.cos(time * 0.2) * d;
  light.position.y = 5 * Math.sin((control.count += 0.005) + 0.5 * Math.PI);

  var light = scene.getObjectByName("pl3");
  light.position.y = 50 * Math.sin((control.count += 0.005) + 1.5 * Math.PI);
}

</script>    </footer>
  </body>
</html>